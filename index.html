<!doctype html> 
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ruleta Aleatoria Mejorada</title>
<style>
  :root{
    --bg:#fff7f6;
    --panel:#fff;
    --accent:#007bff;
    --danger:#e76b6b;
    --muted:#666;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: "Helvetica Neue", Arial, sans-serif;
    background:var(--bg);
    color:#222;
  }
  header{
    background:#2f3338;
    color:#fff;
    height:54px;
    display:flex;
    align-items:center;
    padding:0 18px;
    gap:12px;
  }
  header .nav a{color:#cfcfcf; text-decoration:none; margin-right:12px; font-size:14px}
  main{display:flex; gap:18px; padding:22px; justify-content:center; align-items:flex-start;}
  .left {
    width:640px;
    display:flex;
    flex-direction:column;
    align-items:center;
  }

  h1{
    margin:12px 0 6px;
    font-size:34px;
    font-weight:700;
    text-align:center;
  }

  /* Contenedor de la ruleta */
  .wheel-wrap{
    position: relative;
    width:560px;
    height:560px;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  canvas#wheel{
    border-radius:50%;
    background:var(--panel);
    box-shadow: 0 8px 20px rgba(0,0,0,0.12);
  }

  /* Flecha roja hacia adentro */
  .pointer {
    position:absolute;
    top:50%;
    right:-2px;
    transform:translateY(-50%) rotate(180deg); /* Apunta hacia adentro */
    width:0;
    height:0;
    border-top: 18px solid transparent;
    border-bottom: 18px solid transparent;
    border-left: 26px solid #e74c3c;
    z-index:20;
  }

  /* Banner del ganador arriba */
  .banner {
    position:absolute;
    top:-60px;
    left:50%;
    transform:translateX(-50%);
    background:#f28b82;
    color:#fff;
    padding:10px 20px;
    border-radius:6px;
    font-size:20px;
    font-weight:bold;
    white-space:nowrap;
  }

  .controls {
    margin-top:16px;
    display:flex;
    gap:10px;
  }
  button.primary{
    background:var(--accent);
    color:#fff;
    border:none;
    padding:10px 16px;
    font-size:16px;
    border-radius:8px;
    cursor:pointer;
  }
  button.ghost{
    background:#f4f4f4;
    color:#333;
    border:none;
    padding:8px 12px;
    font-size:14px;
    border-radius:6px;
    cursor:pointer;
  }

  .right{
    width:300px;
    display:flex;
    flex-direction:column;
    gap:8px;
  }
  textarea#names {
    width:100%;
    height:420px;
    resize:vertical;
    font-size:15px;
    padding:8px;
    border-radius:6px;
    border:1px solid #cfcfcf;
  }

  /* Resultado debajo del cuadro de nombres */
  #resultBox{
    margin-top:14px;
    padding:10px;
    font-size:18px;
    font-weight:600;
    min-height:28px;
    text-align:center;
    border:1px solid #cfcfcf;
    border-radius:6px;
    background:#fff;
  }

  footer {
    margin:24px;
    font-size:13px;
    color:#777;
  }

  @media(max-width:980px){
    main{flex-direction:column;align-items:center;}
    .left, .right{width:92%}
    .wheel-wrap{width:420px;height:420px}
    canvas#wheel{width:420px;height:420px}
  }
</style>
</head>
<body>
  <header>
    <div class="nav">
      <a href="#">Inicio</a>
      <a href="#" style="color:#fff">Ruleta</a>
      <a href="#">Dado</a>
      <a href="#">Números al azar</a>
    </div>
  </header>

  <main>
    <div class="left">
      <h1>La Ruleta Aleatoria</h1>

      <div class="wheel-wrap" id="wheelWrap">
        <div class="pointer" id="pointer"></div>
        <canvas id="wheel" width="500" height="500"></canvas>
        <div class="banner" id="banner">Ganador</div>
      </div>

      <div class="controls">
        <button class="primary" id="spinBtn">Iniciar</button>
        <button class="ghost" id="resetBtn">Reiniciar</button>
      </div>
    </div>

    <div class="right">
      <textarea id="names" spellcheck="false">Valentina
Eileen
Luisa
Andrea
Yulissa
Maria
Tayra
Taysha
Leydi</textarea>
      <!-- Resultado se movió aquí debajo -->
      <div id="resultBox" aria-live="polite"></div>
    </div>
  </main>

<script>
const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');
const spinner = document.getElementById('spinBtn');
const resetBtn = document.getElementById('resetBtn');
const namesField = document.getElementById('names');
const banner = document.getElementById('banner');
const resultBox = document.getElementById('resultBox');

let W = canvas.width;
let H = canvas.height;
let cx = W/2, cy = H/2;
let outerR = Math.min(W,H)/2 - 6;
let textR = outerR - 40;
let innerR = 8;

let names = [];
let colors = [];
let arc = 0;

const defaultColors = ["#5b8cff","#ff8a8a","#9be6a8","#ffd8f0","#ffd89e","#c6a9ff","#99d6ff","#f6e6b4","#ffb3d6"];

// Nombres prohibidos
const forbiddenNames = ["Valentina", "Eileen", "Luisa"];

function parseNames(){
  names = namesField.value.split("\n").map(s=>s.trim()).filter(s=>s.length>0);
  if(names.length===0){
    names = ["Sin nombres"];
  }
  arc = 2*Math.PI / names.length;
  colors = [];
  for(let i=0;i<names.length;i++){
    colors.push(defaultColors[i % defaultColors.length]);
  }
}

function drawWithRotation(rotation){
  ctx.save();
  ctx.clearRect(0,0,W,H);
  ctx.translate(cx,cy);
  ctx.rotate(rotation);
  ctx.translate(-cx,-cy);

  for(let i=0;i<names.length;i++){
    const a = i*arc - Math.PI/2;
    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.arc(cx,cy,outerR, a, a+arc, false);
    ctx.closePath();
    ctx.fillStyle = colors[i];
    ctx.fill();
    ctx.strokeStyle = 'rgba(0,0,0,0.08)';
    ctx.stroke();

    // Texto horizontal (sin rotación)
    ctx.save();
    const ang = a + arc/2;
    const tx = cx + Math.cos(ang) * textR;
    const ty = cy + Math.sin(ang) * textR;
    ctx.translate(tx,ty);
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillStyle = "#111";
    ctx.font = "bold 16px Arial";
    ctx.fillText(names[i], 0, 0);
    ctx.restore();
  }

  ctx.beginPath();
  ctx.fillStyle = '#fff';
  ctx.arc(cx,cy,innerR+6,0,Math.PI*2);
  ctx.fill();
  ctx.strokeStyle = 'rgba(0,0,0,0.06)';
  ctx.stroke();
  ctx.restore();
}

let rotation = 0;
let isSpinning = false;
let spinAnimation;

function spinToWinner(){
  if(isSpinning) return;
  isSpinning = true;

  let chosenIndex;
  do {
    chosenIndex = Math.floor(Math.random() * names.length);
  } while (forbiddenNames.includes(names[chosenIndex]));

  const centerAngle = -Math.PI/2 + (chosenIndex + 0.5)*arc;
  const extraTurns = 4 + Math.floor(Math.random()*3);
  const targetRotation = (-centerAngle) + extraTurns * 2 * Math.PI;

  const startRot = rotation;
  const delta = targetRotation - startRot;
  const duration = 4000;
  const startTime = performance.now();

  function step(now){
    const t = Math.min(1, (now - startTime)/duration);
    const eased = 1 - Math.pow(1 - t, 3);
    rotation = startRot + delta * eased;
    drawWithRotation(rotation);

    if(t<1){
      spinAnimation = requestAnimationFrame(step);
    } else {
      isSpinning = false;
      announceWinner(names[chosenIndex]);
    }
  }
  spinAnimation = requestAnimationFrame(step);
}

function announceWinner(name){
  resultBox.textContent = "Ganador: " + name;
  banner.textContent = name;
}

function resetWheel(){
  if(isSpinning){
    cancelAnimationFrame(spinAnimation);
    isSpinning = false;
  }
  rotation = 0;
  drawWithRotation(rotation);
  resultBox.textContent = '';
  banner.textContent = 'Ganador';
}

spinner.addEventListener('click', spinToWinner);
resetBtn.addEventListener('click', resetWheel);
namesField.addEventListener('input', ()=>{ parseNames(); drawWithRotation(rotation); });

parseNames();
drawWithRotation(rotation);
</script>
</body>
</html>
